<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docker/image-manipulation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Image Manipulation | ReNote</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xremagix.github.io/renote/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xremagix.github.io/renote/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xremagix.github.io/renote/docs/docker/image-manipulation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Image Manipulation | ReNote"><meta data-rh="true" name="description" content="The process of creating, managing, and customizing images used to run containers in Docker."><meta data-rh="true" property="og:description" content="The process of creating, managing, and customizing images used to run containers in Docker."><link data-rh="true" rel="icon" href="/renote/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xremagix.github.io/renote/docs/docker/image-manipulation"><link data-rh="true" rel="alternate" href="https://xremagix.github.io/renote/docs/docker/image-manipulation" hreflang="en"><link data-rh="true" rel="alternate" href="https://xremagix.github.io/renote/docs/docker/image-manipulation" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/renote/blog/rss.xml" title="ReNote RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/renote/blog/atom.xml" title="ReNote Atom Feed"><link rel="stylesheet" href="/renote/assets/css/styles.0b6ebd38.css">
<script src="/renote/assets/js/runtime~main.3e0ac109.js" defer="defer"></script>
<script src="/renote/assets/js/main.16f042f1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/renote/"><div class="navbar__logo"><img src="/renote/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/renote/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">ReNote</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/renote/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/renote/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/renote/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="Expand sidebar category &#x27;Tutorial - Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/crdt">CRDT</a><button aria-label="Expand sidebar category &#x27;CRDT&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/renote/docs/category/docker">Docker</a><button aria-label="Collapse sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/concept">Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/renote/docs/docker/image-manipulation">Image Manipulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/container-manipulation">Container Manipulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/containerize-js-app">Containerize JavaScript application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/network-manipulcation">Network Manipulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/containerize-multi-js-app">Containerize Multi-container JavaScript application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/docker-compose">Docker Compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/docker/docker-file">Dockerfile</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/docusaurus">Docusaurus</a><button aria-label="Expand sidebar category &#x27;Docusaurus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/git">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/github">GitHub</a><button aria-label="Expand sidebar category &#x27;GitHub&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/hygen">Hygen</a><button aria-label="Expand sidebar category &#x27;Hygen&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/libraries---packages">Libraries - Packages</a><button aria-label="Expand sidebar category &#x27;Libraries - Packages&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/markdown">Markdown</a><button aria-label="Expand sidebar category &#x27;Markdown&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/setup-sources">Setup sources</a><button aria-label="Expand sidebar category &#x27;Setup sources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/sql">SQL</a><button aria-label="Expand sidebar category &#x27;SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tools">Tools</a><button aria-label="Expand sidebar category &#x27;Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/webrtc">WebRTC</a><button aria-label="Expand sidebar category &#x27;WebRTC&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/renote/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/renote/docs/category/docker"><span itemprop="name">Docker</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Image Manipulation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Image Manipulation</h1>
<p>The process of creating, managing, and customizing images used to run containers in Docker.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-image">Create a Image<a href="#create-a-image" class="hash-link" aria-label="Direct link to Create a Image" title="Direct link to Create a Image">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-dockerfile">Create Dockerfile<a href="#create-dockerfile" class="hash-link" aria-label="Direct link to Create Dockerfile" title="Direct link to Create Dockerfile">​</a></h3>
<p>Create a new file named <code>Dockerfile</code> inside that directory. A Dockerfile is a collection of instructions that, once processed by the daemon, results in an image</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apt-get update &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get install nginx -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>FROM</strong>: instruction <em>sets the base</em> image for your resultant image.
-&gt; By setting <code>ubuntu:latest</code> as the base image here, you get all the goodness of Ubuntu already available in your custom image</p>
</li>
<li>
<p><strong>EXPOSE</strong>: instruction is used to <em>indicate the port</em> that needs to be published.
-&gt; Here it works like a documentation for someone who&#x27;s trying to run a container using your image.</p>
</li>
<li>
<p><strong>RUN</strong>: instruction <em>executes a command</em> inside the container shell. The <code>RUN</code> instructions here are written in <code>shell</code> form. These can also be written in <code>exec</code> form
-&gt; Run those simple Ubuntu commands.</p>
</li>
<li>
<p><strong>CMD</strong>: instruction <em>sets the default command</em> for your image. This instruction is written in <code>exec</code> form or in <code>shell</code> form.
-&gt; Running NGINX as a single process inside containers.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build-image">Build image<a href="#build-image" class="hash-link" aria-label="Direct link to Build image" title="Direct link to Build image">​</a></h3>
<p>To perform an image build, the daemon needs two very specific pieces of information.</p>
<p>These are the name of the <code>Dockerfile</code> and the <code>build</code> context.</p>
<p>The image related commands can be issued using the following syntax:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image &lt;command&gt; &lt;options&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To build an image using the <code>Dockerfile</code> you just wrote, open up your terminal inside the current directory and execute the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image build .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sending build context to Docker daemon  3.584kB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 1/4 : FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; d70eaf7277ea</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 2/4 : EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 9eae86582ec7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 9eae86582ec7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; 8235bd799a56</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 3/4 : RUN apt-get update &amp;&amp;     apt-get install nginx -y &amp;&amp;     apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in a44725cbb3fa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### LONG INSTALLATION STUFF GOES HERE ###</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container a44725cbb3fa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; 3066bd20292d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 4/4 : CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 4792e4691660</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 4792e4691660</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; 3199372aa3fc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Successfully built 3199372aa3fc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>docker image build</code> is the command for building the image. The daemon finds any file named <code>Dockerfile</code> within the context.</li>
<li>The <code>.</code> at the end sets the context for this build. The context means the directory accessible by the daemon during the build process.</li>
</ul>
<p>To run a container using this image, run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker container run --rm --detach --name custom-nginx-packaged --publish 8080:80 3199372aa3fc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ec09d4e1f70c903c3b954c8d7958421cdd1ae3d079b57f929e44131fbf8069a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker container ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ec09d4e1f70c        3199372aa3fc        &quot;nginx -g &#x27;daemon of…&quot;   23 seconds ago      Up 22 seconds       0.0.0.0:8080-&gt;80/tcp   custom-nginx-packaged</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tag-docker-image">Tag docker Image<a href="#tag-docker-image" class="hash-link" aria-label="Direct link to Tag docker Image" title="Direct link to Tag docker Image">​</a></h2>
<p>You can assign custom identifiers to your images instead of relying on the randomly generated ID.</p>
<p>In case of an image, it&#x27;s called <strong>tagging</strong> instead of <strong>naming</strong>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--tag &lt;image repository&gt;:&lt;image tag&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image build --tag custom-nginx:packaged .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sending build context to Docker daemon  1.055MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 1/4 : FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; f63181f19b2f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 2/4 : EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 53ab370b9efc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 53ab370b9efc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; 6d6460a74447</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 3/4 : RUN apt-get update &amp;&amp;     apt-get install nginx -y &amp;&amp;     apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in b4951b6b48bb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### LONG INSTALLATION STUFF GOES HERE ###</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container b4951b6b48bb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; fdc6cdd8925a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 4/4 : CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 3bdbd2af4f0e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 3bdbd2af4f0e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; f8837621b99d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Successfully built f8837621b99d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Successfully tagged custom-nginx:packaged</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In cases where you forgot to tag an image during build time, or maybe you want to change the tag, you can use the <code>image tag</code> command to do that:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image tag &lt;image id&gt; &lt;image repository&gt;:&lt;image tag&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## or ##</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker image tag &lt;image repository&gt;:&lt;image tag&gt; &lt;new image repository&gt;:&lt;new image tag&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="list-and-remove-images">List and Remove Images<a href="#list-and-remove-images" class="hash-link" aria-label="Direct link to List and Remove Images" title="Direct link to List and Remove Images">​</a></h2>
<p>Use <code>container ls</code> to list all the images in your local system:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># REPOSITORY     TAG        IMAGE ID       CREATED         SIZE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;none&gt;         &lt;none&gt;     3199372aa3fc   7 seconds ago   132MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># custom-nginx   packaged   f8837621b99d   4 minutes ago   132MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use <code>image rm</code> to delete the image. The identifier can be the image ID or image repository. If you use the repository, you&#x27;ll have to identify the tag as well</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image rm &lt;image identifier&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image rm custom-nginx:packaged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Untagged: custom-nginx:packaged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deleted: sha256:f8837621b99d3388a9e78d9ce49fbb773017f770eea80470fb85e0052beae242</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deleted: sha256:fdc6cdd8925ac25b9e0ed1c8539f96ad89ba1b21793d061e2349b62dd517dadf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deleted: sha256:c20e4aa46615fe512a4133089a5cd66f9b7da76366c96548790d5bf865bd49c4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deleted: sha256:6d6460a744475a357a2b631a4098aa1862d04510f3625feb316358536fcd8641</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use <code>image prune</code> to clean up all un-tagged dangling images</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image prune --force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deleted Images:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># deleted: sha256:ba9558bdf2beda81b9acc652ce4931a85f0fc7f69dbc91b4efc4561ef7378aff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># deleted: sha256:ad9cc3ff27f0d192f8fa5fadebf813537e02e6ad472f6536847c4de183c02c81</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># deleted: sha256:f1e9b82068d43c1bb04ff3e4f0085b9f8903a12b27196df7f1145aa9296c85e7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># deleted: sha256:ec16024aa036172544908ec4e5f842627d04ef99ee9b8d9aaa26b9c2a4b52baa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Total reclaimed space: 59.19MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>--force</code> or <code>-f</code> option skips any confirmation questions.</p>
<p>The <code>--all</code> or <code>-a</code> option to remove all cached images in your local registry.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="layers-of-docker-image">Layers of Docker Image<a href="#layers-of-docker-image" class="hash-link" aria-label="Direct link to Layers of Docker Image" title="Direct link to Layers of Docker Image">​</a></h2>
<p><img loading="lazy" src="https://docs.docker.com/storage/storagedriver/images/container-layers.webp" alt="Docker official - Layers of Image" class="img_ev3q"></p>
<p>To visualize the many layers of an image, you can use the <code>image history</code> command.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image history custom-nginx:packaged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 7f16387f7307        5 minutes ago       /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 587c805fe8df        5 minutes ago       /bin/sh -c apt-get update &amp;&amp;     apt-get ins…   60MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 6fe4e51e35c1        6 minutes ago       /bin/sh -c #(nop)  EXPOSE 80                    0B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># d70eaf7277ea        17 hours ago        /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;missing&gt;           17 hours ago        /bin/sh -c mkdir -p /run/systemd &amp;&amp; echo &#x27;do…   7B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;missing&gt;           17 hours ago        /bin/sh -c [ -z &quot;$(apt-get indextargets)&quot; ]     0B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;missing&gt;           17 hours ago        /bin/sh -c set -xe   &amp;&amp; echo &#x27;#!/bin/sh&#x27; &gt; /…   811B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;missing&gt;           17 hours ago        /bin/sh -c #(nop) ADD file:435d9776fdd3a1834…   72.9MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The image comprises of many read-only layers, each recording a new set of changes to the state triggered by certain instructions.</p>
<p>When you start a container using an image, you get a new writable layer on top of the other layers.</p>
<p>This layering phenomenon that happens every time you work with Docker has been made possible by a union file system.</p>
<p>By utilizing this concept, Docker can avoid data duplication and can use previously created layers as a cache for later builds. This results in compact, efficient images that can be used everywhere.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-nginx-from-source">Build NGINX from Source<a href="#build-nginx-from-source" class="hash-link" aria-label="Direct link to Build NGINX from Source" title="Direct link to Build NGINX from Source">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apt-get update &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get install build-essential\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libpcre3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libpcre3-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    zlib1g \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    zlib1g-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libssl1.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libssl-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY nginx-1.19.2.tar.gz .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN tar -xvf nginx-1.19.2.tar.gz &amp;&amp; rm nginx-1.19.2.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN cd nginx-1.19.2 &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./configure \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --sbin-path=/usr/bin/nginx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --conf-path=/etc/nginx/nginx.conf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --error-log-path=/var/log/nginx/error.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --http-log-path=/var/log/nginx/access.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-pcre \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --pid-path=/var/run/nginx.pid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-http_ssl_module &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    make &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /nginx-1.19.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This can be done in 7 steps:</p>
<ul>
<li>
<p>Get a good base image for building the application</p>
<ul>
<li>The <code>FROM</code> instruction sets Ubuntu as the base image making an ideal environment for building any application.</li>
</ul>
</li>
<li>
<p>Install necessary build dependencies on the base image.</p>
<ul>
<li>The <code>RUN</code> instruction installs standard packages necessary for building NGINX from source.</li>
</ul>
</li>
<li>
<p>Copy the source file inside the image.</p>
<ul>
<li>The <code>COPY</code> instruction is responsible for copying the the <code>nginx-1.19.2.tar.gz</code> file inside the image.</li>
</ul>
</li>
<li>
<p>Extract the contents of the archive and get rid of it.</p>
<ul>
<li>The <code>RUN</code> instruction here extracts the contents from the archive using tar and gets rid of it afterwards.</li>
</ul>
</li>
<li>
<p>Configure the build, compile and install the program using the make tool.</p>
<ul>
<li>The archive file contains a directory called <code>nginx-1.19.2</code> containing the source code. So in the next <code>RUN</code> instruction, you&#x27;ll have to cd inside that directory and perform the build process.</li>
</ul>
</li>
<li>
<p>Get rid of the extracted source code.</p>
<ul>
<li>Once the build and installation is complete, you continue to use <code>RUN</code> instruction to remove the <code>nginx-1.19.2</code> directory using <code>rm</code> command.</li>
</ul>
</li>
<li>
<p>Run nginx executable.</p>
<ul>
<li>On the final step you start NGINX in single process by using <code>CMD</code> intruction like before.</li>
</ul>
</li>
</ul>
<p>Now we can build an image:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image build --tag custom-nginx:built .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 1/7 : FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; d70eaf7277ea</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 2/7 : RUN apt-get update &amp;&amp;     apt-get install build-essential                    libpcre3                     libpcre3-dev                     zlib1g                     zlib1g-dev                     libssl-dev                     -y &amp;&amp;     apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 2d0aa912ea47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### LONG INSTALLATION STUFF GOES HERE ###</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 2d0aa912ea47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; cbe1ced3da11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 3/7 : COPY nginx-1.19.2.tar.gz .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; 7202902edf3f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 4/7 : RUN tar -xvf nginx-1.19.2.tar.gz &amp;&amp; rm nginx-1.19.2.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ---&gt; Running in 4a4a95643020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### LONG EXTRACTION STUFF GOES HERE ###</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 4a4a95643020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; f9dec072d6d6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 5/7 : RUN cd nginx-1.19.2 &amp;&amp;     ./configure         --sbin-path=/usr/bin/nginx         --conf-path=/etc/nginx/nginx.conf         --error-log-path=/var/log/nginx/error.log         --http-log-path=/var/log/nginx/access.log         --with-pcre         --pid-path=/var/run/nginx.pid         --with-http_ssl_module &amp;&amp;     make &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in b07ba12f921e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### LONG CONFIGURATION AND BUILD STUFF GOES HERE ###</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container b07ba12f921e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; 5a877edafd8b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 6/7 : RUN rm -rf /nginx-1.19.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 947e1d9ba828</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 947e1d9ba828</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; a7702dc7abb7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Step 7/7 : CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; Running in 3110c7fdbd57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Removing intermediate container 3110c7fdbd57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#  ---&gt; eae55f7369d3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Successfully built eae55f7369d3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Successfully tagged custom-nginx:built</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There are some places where we can make improvements:</p>
<ul>
<li>
<p>Instead of hard coding the filename, you can create an argument using the <code>ARG</code> instruction.</p>
</li>
<li>
<p>Instead of downloading the archive manually, you can let the daemon download the file from the internet during the build process using <code>ADD</code> instruction.</p>
</li>
</ul>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>It isn&#x27;t recommended to use build arguments for passing secrets such as user credentials, API tokens, etc. Build arguments are visible in the <code>docker history</code> command and in <code>max</code> mode provenance attestations.</p><p>Ref: <a href="https://docs.docker.com/reference/dockerfile/#arg" target="_blank" rel="noopener noreferrer">Docker Official - DockerFile #arg</a></p></div></div>
<p>The <code>Dockerfile</code> will be updated as follow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apt-get update &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get install build-essential\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libpcre3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libpcre3-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    zlib1g \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    zlib1g-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libssl1.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libssl-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG FILENAME=&quot;nginx-1.19.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG EXTENSION=&quot;tar.gz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD https://nginx.org/download/${FILENAME}.${EXTENSION} .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN tar -xvf ${FILENAME}.${EXTENSION} &amp;&amp; rm ${FILENAME}.${EXTENSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN cd ${FILENAME} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./configure \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --sbin-path=/usr/bin/nginx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --conf-path=/etc/nginx/nginx.conf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --error-log-path=/var/log/nginx/error.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --http-log-path=/var/log/nginx/access.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-pcre \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --pid-path=/var/run/nginx.pid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-http_ssl_module &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    make &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /${FILENAME}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimize-docker-image">Optimize Docker Image<a href="#optimize-docker-image" class="hash-link" aria-label="Direct link to Optimize Docker Image" title="Direct link to Optimize Docker Image">​</a></h2>
<p>The <code>RUN</code> instruction installs a lot of stuff. Although these packages are necessary for building NGINX from source, they are not necessary for running it, only two are necessary for running NGINX. These are <code>libpcre3</code> and <code>zlib1g</code>.</p>
<p>So a better idea would be to uninstall the other packages once the build process is done.</p>
<p>The updated <code>Dockerfile</code> will be as follow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM ubuntu:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG FILENAME=&quot;nginx-1.19.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG EXTENSION=&quot;tar.gz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD https://nginx.org/download/${FILENAME}.${EXTENSION} .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apt-get update &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apt-get install build-essential \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libpcre3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libpcre3-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    zlib1g \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    zlib1g-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libssl1.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    libssl-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    -y &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tar -xvf ${FILENAME}.${EXTENSION} &amp;&amp; rm ${FILENAME}.${EXTENSION} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd ${FILENAME} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./configure \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --sbin-path=/usr/bin/nginx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --conf-path=/etc/nginx/nginx.conf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --error-log-path=/var/log/nginx/error.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --http-log-path=/var/log/nginx/access.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-pcre \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --pid-path=/var/run/nginx.pid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-http_ssl_module &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    make &amp;&amp; make install &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd / &amp;&amp; rm -rfv /${FILENAME} &amp;&amp; \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    apt-get remove build-essential \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    libpcre3-dev \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    zlib1g-dev \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    libssl-dev \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                    -y &amp;&amp; \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    apt-get autoremove -y &amp;&amp; \</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By run those commands, the unnecessary packages are being uninstalled and cache cleared.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you install packages and then remove them in separate <code>RUN</code> instructions, they&#x27;ll live in <em>separate layers of the image</em>.</p><p>Although the final image will not have the removed packages, their size will still be added to the final image since they exist in one of the layers consisting the image.</p><p>So make sure you <strong>make these kind of changes on a single layer</strong>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="embracing-alpine-linux">Embracing Alpine Linux<a href="#embracing-alpine-linux" class="hash-link" aria-label="Direct link to Embracing Alpine Linux" title="Direct link to Embracing Alpine Linux">​</a></h2>
<p><a href="https://alpinelinux.org/" target="_blank" rel="noopener noreferrer">Alpine</a> is lightweight, secure and is a much better fit for creating containers than the other distributions.</p>
<p>You can update <code>Dockerfile</code> using Alpine as follow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM alpine:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG FILENAME=&quot;nginx-1.19.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG EXTENSION=&quot;tar.gz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD https://nginx.org/download/${FILENAME}.${EXTENSION} .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add --no-cache pcre zlib &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apk add --no-cache \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            --virtual .build-deps \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            build-base \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pcre-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            zlib-dev \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            openssl-dev &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tar -xvf ${FILENAME}.${EXTENSION} &amp;&amp; rm ${FILENAME}.${EXTENSION} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd ${FILENAME} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./configure \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --sbin-path=/usr/bin/nginx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --conf-path=/etc/nginx/nginx.conf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --error-log-path=/var/log/nginx/error.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --http-log-path=/var/log/nginx/access.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-pcre \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --pid-path=/var/run/nginx.pid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --with-http_ssl_module &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    make &amp;&amp; make install &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd / &amp;&amp; rm -rfv /${FILENAME} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apk del .build-deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><code>apk add</code> is as same as <code>apt-get install</code> in ubuntu, using for installing packages.</p>
</li>
<li>
<p><code>apk del</code> is as same as <code>apt-get remove</code> in ubuntu, using for uninstalling packages.</p>
</li>
<li>
<p>The <code>--no-cache</code> option means that the downloaded package won&#x27;t be cached.</p>
</li>
<li>
<p>The <code>--virtual</code> option for the apk add command is used for bundling a bunch of packages into a single virtual package for easier management.</p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xREMAGIx/renote/tree/main/docs/docker/image-manipulation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/renote/docs/docker/concept"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Concepts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/renote/docs/docker/container-manipulation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Container Manipulation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-image" class="table-of-contents__link toc-highlight">Create a Image</a><ul><li><a href="#create-dockerfile" class="table-of-contents__link toc-highlight">Create Dockerfile</a></li><li><a href="#build-image" class="table-of-contents__link toc-highlight">Build image</a></li></ul></li><li><a href="#tag-docker-image" class="table-of-contents__link toc-highlight">Tag docker Image</a></li><li><a href="#list-and-remove-images" class="table-of-contents__link toc-highlight">List and Remove Images</a></li><li><a href="#layers-of-docker-image" class="table-of-contents__link toc-highlight">Layers of Docker Image</a></li><li><a href="#build-nginx-from-source" class="table-of-contents__link toc-highlight">Build NGINX from Source</a></li><li><a href="#optimize-docker-image" class="table-of-contents__link toc-highlight">Optimize Docker Image</a></li><li><a href="#embracing-alpine-linux" class="table-of-contents__link toc-highlight">Embracing Alpine Linux</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Notes</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/renote/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/renote/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 ReNote. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>