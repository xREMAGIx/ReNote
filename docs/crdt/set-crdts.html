<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-crdt/set-crdts" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Set CRDTs | ReNote</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xremagix.github.io/renote/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xremagix.github.io/renote/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xremagix.github.io/renote/docs/crdt/set-crdts"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Set CRDTs | ReNote"><meta data-rh="true" name="description" content="Set CRDTs (Conflict-free Replicated Data Types) are a type of data structure that allows multiple replicas to converge to the same state without the need for coordination or consensus."><meta data-rh="true" property="og:description" content="Set CRDTs (Conflict-free Replicated Data Types) are a type of data structure that allows multiple replicas to converge to the same state without the need for coordination or consensus."><link data-rh="true" rel="icon" href="/renote/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xremagix.github.io/renote/docs/crdt/set-crdts"><link data-rh="true" rel="alternate" href="https://xremagix.github.io/renote/docs/crdt/set-crdts" hreflang="en"><link data-rh="true" rel="alternate" href="https://xremagix.github.io/renote/docs/crdt/set-crdts" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/renote/blog/rss.xml" title="ReNote RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/renote/blog/atom.xml" title="ReNote Atom Feed"><link rel="stylesheet" href="/renote/assets/css/styles.0b6ebd38.css">
<script src="/renote/assets/js/runtime~main.e04d7be3.js" defer="defer"></script>
<script src="/renote/assets/js/main.46d04a08.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/renote/"><div class="navbar__logo"><img src="/renote/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/renote/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">ReNote</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/renote/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/renote/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/renote/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="Expand sidebar category &#x27;Tutorial - Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/renote/docs/category/crdt">CRDT</a><button aria-label="Collapse sidebar category &#x27;CRDT&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/definition">Definition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/objects-and-operations">Objects and Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/state-based-crdt">State-based Convergent Replicated Data Type (CvRDT)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/op-based-crdt">Operation-based Commutative Replicated Data Type (CmRDT)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/relation-cvrdt-cmrdt">Relation between CvRDT and CmRDT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/types-of-crdt">Types Of CRDT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/counter-crdts">Counter CRDTs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/register-crdts">Register CRDTs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/renote/docs/crdt/set-crdts">Set CRDTs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/references">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/crdt/yjs-framework">Yjs Framework</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/docusaurus">Docusaurus</a><button aria-label="Expand sidebar category &#x27;Docusaurus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/git">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/github">GitHub</a><button aria-label="Expand sidebar category &#x27;GitHub&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/hygen">Hygen</a><button aria-label="Expand sidebar category &#x27;Hygen&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/libraries---packages">Libraries - Packages</a><button aria-label="Expand sidebar category &#x27;Libraries - Packages&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/markdown">Markdown</a><button aria-label="Expand sidebar category &#x27;Markdown&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/setup-sources">Setup sources</a><button aria-label="Expand sidebar category &#x27;Setup sources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/sql">SQL</a><button aria-label="Expand sidebar category &#x27;SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tools">Tools</a><button aria-label="Expand sidebar category &#x27;Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/webrtc">WebRTC</a><button aria-label="Expand sidebar category &#x27;WebRTC&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/renote/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/renote/docs/category/crdt"><span itemprop="name">CRDT</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Set CRDTs</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Set CRDTs</h1>
<p>Set CRDTs (Conflict-free Replicated Data Types) are a type of data structure that allows multiple replicas to converge to the same state without the need for coordination or consensus.</p>
<p>In a Set CRDT, each replica maintains a set of elements, and updates are propagated to other replicas to achieve convergence. Set CRDTs can be used in distributed systems to provide consistent and reliable access to shared data.</p>
<p>Sets constitute one of the most basic data structures. Containers, Maps, and Graphs are all based on Sets.</p>
<p>Operations add and remove are applied sequentially as they arrive. Initially, the set is empty. Replica 1 adds element a, then removes a; its state is again empty. Replica 2 adds the same element a; when Replica 1 applies this operation, its (final) state becomes &#x27;a&#x27;. Replica 3 receives the two add operations; the second one has no effect since a is already in the set. Then it receives the remove, which makes its state empty. Both Replica 1 and Replica 3 have applied all operations in causal order, yet they diverge.</p>
<p>Ref: <a href="https://inria.hal.science/inria-00555588/document" target="_blank" rel="noopener noreferrer">A comprehensive study of Convergent and Commutative Replicated Data Types</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grow-only-set--g-set-">Grow-Only Set ( G-Set )<a href="#grow-only-set--g-set-" class="hash-link" aria-label="Direct link to Grow-Only Set ( G-Set )" title="Direct link to Grow-Only Set ( G-Set )">​</a></h2>
<p>A very simple solution — to disallow rmv() operation at all. add() operations commute, the merge() function is just a set union.</p>
<p>Illustrate G-Set:</p>
<p><img loading="lazy" alt="G Set" src="data:image/png;base64,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" width="352" height="458" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>A Grow-Only Set (G-Set) is a type of Conflict-Free Replicated Data Type (CRDT) that can be used to implement a set that can only grow, but never shrink. In other words, elements can be added to the set, but once added, they cannot be removed.</p>
<p>G-Sets work by maintaining a set of unique identifiers that represent the elements in the set. When an element is added to the set, it is assigned a unique identifier. The set of identifiers is then replicated to all replicas, and each replica can independently determine which elements are in the set based on the set of identifiers.</p>
<p>One of the key benefits of G-Sets is that they are simple and easy to implement. They do not require complex merging or conflict resolution algorithms, since all replicas simply maintain a copy of the set of identifiers.</p>
<p>The G-Set has the same downside as the Grow-Only Set, which is that it grows indefinitely and cannot be explicitly deleted. Once an element is added to the set, it cannot be removed. This can lead to a situation where the set becomes too large to be stored efficiently, especially in a distributed system where the set is replicated across multiple nodes. Additionally, since G-Set does not track removals, there is no way to prevent the same element from being added to the set multiple times, which may not be desirable in some use cases.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-code">Example code<a href="#example-code" class="hash-link" aria-label="Direct link to Example code" title="Direct link to Example code">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">GSet</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Set</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Endpoint</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GSet</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> crdt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Crdt</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GSet</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">unknown</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">Query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">crdt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">crdt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">Prepare</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">Effect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> props </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Database</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> replica</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActorContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">replicator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">crdt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> replica</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> add </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">async</span><span class="token generic-function"> </span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> command</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Command</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">async</span><span class="token generic-function"> </span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>How code work:</strong>
We define the GSet type, which is a set that only supports adding elements, and not removing or updating them. We then define the Endpoint type, which represents a reference to a CRDT instance.</p>
<p>We then define the crdt object, which represents the G-Set CRDT. It has a Default property, which specifies the initial state of the CRDT, a Query property, which specifies how to extract the value of the CRDT, a Prepare property, which specifies how to prepare a command for the CRDT, and an Effect property, which specifies how to apply a command to the CRDT.</p>
<p>We then define the props function, which creates a replicator function for the G-Set CRDT, and the add and query functions, which allow us to add elements to the CRDT and query its current state, respectively.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-scenario">Sample scenario<a href="#sample-scenario" class="hash-link" aria-label="Direct link to Sample scenario" title="Direct link to Sample scenario">​</a></h3>
<p>A practical example of using a G-Set CRDT could be in a collaborative shopping list application. Suppose there are multiple users who are collaborating on a single shopping list. Each user can add items to the list, and any user can mark an item as &quot;purchased&quot; when they buy it.</p>
<p>To implement this functionality using a G-Set CRDT, we could create a G-Set for the shopping list. Each item in the shopping list would be a unique identifier, such as a UUID. Whenever a user adds an item to the list, they would insert the item&#x27;s identifier into the G-Set. Whenever a user marks an item as &quot;purchased&quot;, they would send a message to all other users indicating that the item has been purchased. Each user would then remove the item&#x27;s identifier from their local G-Set.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="two-phase-set--2p-set-">Two Phase Set ( 2P-Set )<a href="#two-phase-set--2p-set-" class="hash-link" aria-label="Direct link to Two Phase Set ( 2P-Set )" title="Direct link to Two Phase Set ( 2P-Set )">​</a></h2>
<p>Allows rmv() operation but you can&#x27;t re-add an element after its deletion. An additional G-set can be used to track removed elements (also called tombstone set).</p>
<p>Illustrate 2P-Set:</p>
<p><img loading="lazy" alt="2P Set" src="data:image/png;base64,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" width="304" height="484" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-1">Overview<a href="#overview-1" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>Two-Phase Set (2P-Set) is a type of Set CRDT that addresses the limitations of the G-Set CRDT by adding a remove operation. Like the G-Set, it is a grow-only set, which means that elements can only be added to the set and never removed. However, unlike the G-Set, it adds an additional set to keep track of elements that have been removed from the original set.</p>
<p>The 2P-Set maintains two sets - an &quot;add set&quot; and a &quot;remove set&quot;. When an element is added to the set, it is added to the &quot;add set&quot;. When an element is to be removed from the set, instead of actually removing it, it is added to the &quot;remove set&quot;. This allows the 2P-Set to keep track of the elements that were removed, without actually removing them from the set.</p>
<p>One of the key benefits of the 2P-Set is that it is monotonic, meaning that it is guaranteed to only grow in size and never shrink. Additionally, the remove operation is idempotent, meaning that adding an element to the remove set multiple times has the same effect as adding it only once. This ensures that concurrent removal operations don&#x27;t interfere with each other.</p>
<p>The main downside of 2P-Set is that it is not able to remove elements once they have been added to the set. This means that if a client erroneously adds an element to the set, there is no way to remove it, even if other clients haven&#x27;t added it yet. Additionally, if a client adds an element to the set and then removes it, they cannot add it back again, even if other clients haven&#x27;t removed it yet. This limitation can be problematic for some use cases, as it may lead to inconsistencies or inaccuracies in the data.</p>
<p>To overcome this limitation, other set CRDTs have been developed that allow for the removal of elements, such as the OR-Set (Observed-Remove Set) and the 3P-Set (Three-Phase Set).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-code-1">Example code<a href="#example-code-1" class="hash-link" aria-label="Direct link to Example code" title="Direct link to Example code">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">TwoPSet</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  additions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Set</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  removals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Set</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Operation</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;add&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;remove&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Endpoint</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TwoPSet</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Operation</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> crdt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Crdt</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TwoPSet</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">unknown</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Operation</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">unknown</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    additions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    removals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">Query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">crdt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">crdt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">additions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">Prepare</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">Effect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;add&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        additions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">additions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        removals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removals</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">type </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;remove&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">additions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          additions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">additions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          removals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> existing</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> existing</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> props </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Database</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> replica</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActorContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">replicator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">crdt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> replica</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> add </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">async</span><span class="token generic-function"> </span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> command</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Command</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Operation</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;add&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> remove </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">async</span><span class="token generic-function"> </span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> command</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Command</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Operation</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;remove&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">async</span><span class="token generic-function"> </span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name constant" style="color:#36acaa">T</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Endpoint</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">CRDT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this implementation, the <code>TwoPSet</code> type represents a 2P-Set CRDT, which contains two sets: <code>additions</code> and <code>removals</code>. The <code>Operation</code> type defines two possible operations: &quot;add&quot; and &quot;remove&quot;. The <code>Endpoint</code> type is defined similarly to the previous examples, with the addition of the <code>Operation</code> type.</p>
<p>The <code>crdt</code> object is the actual CRDT, with the <code>Default</code>, <code>Query</code>, <code>Prepare</code>, and <code>Effect</code> properties defined as before.</p>
<p>The <code>props</code> function returns a replicator function for a 2P-Set CRDT.</p>
<p>The <code>add</code> and <code>remove</code> functions take a value and an endpoint, and add or remove the value from the set, respectively.</p>
<p>The <code>query</code> function takes an endpoint and returns the current set of values as an array.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-scenario-1">Sample scenario<a href="#sample-scenario-1" class="hash-link" aria-label="Direct link to Sample scenario" title="Direct link to Sample scenario">​</a></h3>
<p>A 2P-Set can be useful in a collaborative document editing scenario where multiple users can add or remove items from a list.</p>
<p>Let&#x27;s say we have a to-do list that multiple users can access and modify concurrently. We want to ensure that each user has their own independent copy of the list, but also that they can merge their changes with the changes made by other users.</p>
<p>We can use a 2P-Set to achieve this. Each user would have their own 2P-Set for the to-do list. The &quot;add&quot; operation would add an item to the &quot;added&quot; set, while the &quot;remove&quot; operation would add the item to the &quot;removed&quot; set. When merging the sets from multiple users, we simply union their added and removed sets to get the final list.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="last-write-wins-element-set--lww-element-set-">Last Write Wins Element Set ( LWW-Element-Set )<a href="#last-write-wins-element-set--lww-element-set-" class="hash-link" aria-label="Direct link to Last Write Wins Element Set ( LWW-Element-Set )" title="Direct link to Last Write Wins Element Set ( LWW-Element-Set )">​</a></h2>
<p>Idea is to introduce a total order on a set. For example, generating timestamps. We need to have two sets: add-set and remove-set.</p>
<p>add() adds (element, unique_id()) to the add-set, rmv() adds to the remove-set. lookup() checks where the id is greater — in add-set or rmv-set.</p>
<p><img loading="lazy" alt="LWW Set" src="/renote/assets/images/lwwSet-f7f6f511b1425b76d21d37cab919a4bb.png" width="1013" height="324" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-2">Overview<a href="#overview-2" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>The Last Write Wins Element Set (LWW-Element-Set) is a type of Set CRDT that allows the addition and removal of elements in a distributed system. Similar to the LWW-Register, LWW-Element-Set resolves conflicts by comparing timestamps.</p>
<p>Each element in the set is associated with a timestamp indicating the time of its last addition or removal. The set tracks the additions and removals of elements by maintaining two internal sets, an &quot;add set&quot; and a &quot;remove set&quot;, that contain the added and removed elements respectively.</p>
<p>When adding an element to the set, it is added to the &quot;add set&quot; with the current timestamp. When removing an element, it is added to the &quot;remove set&quot; with the current timestamp.</p>
<p>To determine if an element is currently in the set, the set checks if the element is in the &quot;add set&quot; and not in the &quot;remove set&quot;, or if the element is in both sets but was added more recently than it was removed.</p>
<p>One downside of LWW-Element-Set is that it can suffer from &quot;rebirth&quot; or &quot;tombstone&quot; problems, where an element that was previously removed and then re-added may still be considered removed if the remove timestamp is greater than the add timestamp. This can be mitigated by using a higher resolution timestamp or by implementing a garbage collection mechanism that removes old elements from the set.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-code-2">Example code<a href="#example-code-2" class="hash-link" aria-label="Direct link to Example code" title="Direct link to Example code">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">Element</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LWWSet</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> addSet</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Set</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Element</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> removeSet</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Set</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Element</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">addSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removeSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">addSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isRemoved</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">other</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> LWWSet</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">addSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isRemoved</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">addSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removeSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isAdded</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removeSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isRemoved</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">removeSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isAdded</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">addSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timestamp </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this implementation, the <code>LWWSet</code> class keeps track of two sets: <code>addSet</code> and <code>removeSet</code>. The <code>add</code> method adds an element to the <code>addSet</code> with a timestamp. The <code>remove</code> method adds an element to the <code>removeSet</code> with a timestamp.</p>
<p>The <code>has</code> method checks if an element exists in the <code>addSet</code> and has not been removed from the <code>removeSet</code> with a later timestamp.</p>
<p>The <code>merge</code> method takes another <code>LWWSet</code> as an argument and merges its <code>addSet</code> and <code>removeSet</code> with its own, using the timestamps to resolve conflicts.</p>
<p>Overall, this implementation follows the basic idea of LWW-Set by keeping track of both additions and removals with timestamps and resolving conflicts using the timestamps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-scenario-2">Sample scenario<a href="#sample-scenario-2" class="hash-link" aria-label="Direct link to Sample scenario" title="Direct link to Sample scenario">​</a></h3>
<p>LWW-Set can be useful in any application where there is a need to track the most recent updates to a set of items. One practical example is a collaborative document editor where multiple users can edit a document simultaneously. In this scenario, LWW-Set can be used to track the changes made to the document by different users and ensure that the most recent changes are reflected in the final document.</p>
<p>For example, let&#x27;s say we have a document editor where multiple users can add or remove words from a document. We can represent the document as an LWW-Set where each element is a word and its timestamp indicates when it was last updated. Whenever a user makes a change to the document, we update the corresponding element in the LWW-Set with the current timestamp.</p>
<p>When multiple users make changes to the same word, the one with the most recent timestamp will be considered the most recent update. We can use this information to resolve conflicts and ensure that the final document reflects the most recent changes made by all users.</p>
<p>LWW-Set can also be useful in distributed systems where multiple nodes need to track changes to a set of items. For example, in a distributed cache where multiple nodes can update the cache simultaneously, LWW-Set can be used to track the most recent updates and ensure that all nodes have consistent data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="positive-negative-set--pn-set-">Positive Negative Set ( PN-Set )<a href="#positive-negative-set--pn-set-" class="hash-link" aria-label="Direct link to Positive Negative Set ( PN-Set )" title="Direct link to Positive Negative Set ( PN-Set )">​</a></h2>
<p>One more way with ordering a set — add a counter per each element. Increase it on add() operation, decrease on rmv(). Element to be considered in the set if and only if his counter is positive.</p>
<p>Notice an interesting side-effect: the element didn&#x27;t appear after it has been added in the 3rd replica</p>
<p><img loading="lazy" alt="PN Set" src="/renote/assets/images/pnSet-ff2d0b403be120733ef293ccea6b7a1d.png" width="1023" height="344" class="img_ev3q"></p>
<p>Initially, our PN-Set is empty. Replica 1 performs <code>add(e)</code>, element <code>e</code> has a count of 1.</p>
<p>The operation propagates to Replica 3. Now Replicas 1 and 3 both concurrently execute <code>remove(e)</code>, after Replica 3 applies both operations, <code>e</code> has a count of <code>-1</code>.</p>
<p>A subsequent <code>add(e)</code> has no effect: thus, after adding an element to an empty &quot;set&quot; it remains empty!</p>
<p>For some applications, this may be the intended semantics. for instance, in an inventory, a negative count may account for goods in transit. In others, this may be considered a bug.</p>
<p>Although the semantics are strange, PN-Set converges; thus if Replica 2 concurrent executes <code>add(e)</code> all replicas converge to state <code>{e}</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-code-3">Example code<a href="#example-code-3" class="hash-link" aria-label="Direct link to Example code" title="Direct link to Example code">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">PNSet</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> positives </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name"> </span><span class="token class-name builtin">number</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> negatives </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name constant" style="color:#36acaa">T</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name"> </span><span class="token class-name builtin">number</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> curCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> curCounter </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> posCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> negCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">negatives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posCounter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> negCounter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">negatives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> negCounter </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> posCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> negCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">negatives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> posCounter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> negCounter</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">T</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> posCounter</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">positives</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> negCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">negatives</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posCounter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> negCounter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">elem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="observed-remove-set--or-set-add-win-set-">Observed-Remove Set ( OR-Set, Add-Win Set )<a href="#observed-remove-set--or-set-add-win-set-" class="hash-link" aria-label="Direct link to Observed-Remove Set ( OR-Set, Add-Win Set )" title="Direct link to Observed-Remove Set ( OR-Set, Add-Win Set )">​</a></h2>
<p>add() has priority over rmv() In this data type. An example of possible implementation could be: add a unique tag (per element) to each newly added element. Then rmv() sends all seen tags of the element to other replicas. Replicas keep other tags.</p>
<p><img loading="lazy" alt="OR Set" src="/renote/assets/images/orSet-2cd89e80cafc0eb15a9c12671f9b2be8.png" width="773" height="335" class="img_ev3q"></p>
<p>The payload consists of a set of pairs <code>(element, unique-identifier)</code>. A <code>lookup(e)</code> extracts element <code>e</code> from the pairs. Operation <code>add(e)</code> generates a unique identifier in the source replica, which is then propagated to downstream replicas, which insert the pair into their payload. Two <code>add(e)</code> generate two unique pairs, but <code>lookup</code> masks the duplicates.</p>
<p>When a client calls <code>remove(e)</code> at some source, the set of unique tags associated with <code>e</code> at the source is recorded. Downstream, all such pairs are removed from the local payload. Thus, when <code>remove(e)</code> happens-after any number of <code>add(e)</code>, all duplicate pairs are removed, and the element is not in the set any more, as expected intuitively. When <code>add(e)</code> is concurrent with <code>remove(e)</code>, the <code>add</code> takes precedence, as the unique tag generated by <code>add</code> cannot be observed by <code>remove</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="remove-win-set">Remove-win Set<a href="#remove-win-set" class="hash-link" aria-label="Direct link to Remove-win Set" title="Direct link to Remove-win Set">​</a></h2>
<p>Same as above but rmv() has priority over add()</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xREMAGIx/renote/tree/main/docs/crdt/set-crdts.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/renote/docs/crdt/register-crdts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Register CRDTs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/renote/docs/crdt/references"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">References</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#grow-only-set--g-set-" class="table-of-contents__link toc-highlight">Grow-Only Set ( G-Set )</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#example-code" class="table-of-contents__link toc-highlight">Example code</a></li><li><a href="#sample-scenario" class="table-of-contents__link toc-highlight">Sample scenario</a></li></ul></li><li><a href="#two-phase-set--2p-set-" class="table-of-contents__link toc-highlight">Two Phase Set ( 2P-Set )</a><ul><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#example-code-1" class="table-of-contents__link toc-highlight">Example code</a></li><li><a href="#sample-scenario-1" class="table-of-contents__link toc-highlight">Sample scenario</a></li></ul></li><li><a href="#last-write-wins-element-set--lww-element-set-" class="table-of-contents__link toc-highlight">Last Write Wins Element Set ( LWW-Element-Set )</a><ul><li><a href="#overview-2" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#example-code-2" class="table-of-contents__link toc-highlight">Example code</a></li><li><a href="#sample-scenario-2" class="table-of-contents__link toc-highlight">Sample scenario</a></li></ul></li><li><a href="#positive-negative-set--pn-set-" class="table-of-contents__link toc-highlight">Positive Negative Set ( PN-Set )</a><ul><li><a href="#example-code-3" class="table-of-contents__link toc-highlight">Example code</a></li></ul></li><li><a href="#observed-remove-set--or-set-add-win-set-" class="table-of-contents__link toc-highlight">Observed-Remove Set ( OR-Set, Add-Win Set )</a></li><li><a href="#remove-win-set" class="table-of-contents__link toc-highlight">Remove-win Set</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Notes</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/renote/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/renote/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 ReNote. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>