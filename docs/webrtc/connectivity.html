<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-webrtc/connectivity" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">WebRTC Connectivity | ReNote</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xremagix.github.io/renote/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xremagix.github.io/renote/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xremagix.github.io/renote/docs/webrtc/connectivity"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="WebRTC Connectivity | ReNote"><meta data-rh="true" name="description" content="Describes how the various WebRTC-related protocols interact with one another in order to create a connection and transfer data and/or media among peers."><meta data-rh="true" property="og:description" content="Describes how the various WebRTC-related protocols interact with one another in order to create a connection and transfer data and/or media among peers."><link data-rh="true" rel="icon" href="/renote/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xremagix.github.io/renote/docs/webrtc/connectivity"><link data-rh="true" rel="alternate" href="https://xremagix.github.io/renote/docs/webrtc/connectivity" hreflang="en"><link data-rh="true" rel="alternate" href="https://xremagix.github.io/renote/docs/webrtc/connectivity" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/renote/blog/rss.xml" title="ReNote RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/renote/blog/atom.xml" title="ReNote Atom Feed"><link rel="stylesheet" href="/renote/assets/css/styles.0b6ebd38.css">
<script src="/renote/assets/js/runtime~main.187bdf2b.js" defer="defer"></script>
<script src="/renote/assets/js/main.8910dd3f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/renote/"><div class="navbar__logo"><img src="/renote/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/renote/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">ReNote</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/renote/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/renote/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/renote/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="Expand sidebar category &#x27;Tutorial - Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/crdt">CRDT</a><button aria-label="Expand sidebar category &#x27;CRDT&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/docusaurus">Docusaurus</a><button aria-label="Expand sidebar category &#x27;Docusaurus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/github">GitHub</a><button aria-label="Expand sidebar category &#x27;GitHub&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/renote/docs/category/markdown">Markdown</a><button aria-label="Expand sidebar category &#x27;Markdown&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/renote/docs/category/webrtc">WebRTC</a><button aria-label="Collapse sidebar category &#x27;WebRTC&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/webrtc/protocols">WebRTC Protocols</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/renote/docs/webrtc/connectivity">WebRTC Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/webrtc/negotiation">The WebRTC perfect negotiation pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/webrtc/demo">Demos (TODO)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/webrtc/group-calling-architecture">Group calling architecture (TODO)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/renote/docs/webrtc/references">References</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/renote/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/renote/docs/category/webrtc"><span itemprop="name">WebRTC</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">WebRTC Connectivity</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>WebRTC Connectivity</h1>
<p>Describes how the various WebRTC-related protocols interact with one another in order to create a connection and transfer data and/or media among peers.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Resource: <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Connectivity" target="_blank" rel="noopener noreferrer">WebRTC connectivity - MDN</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="signalling">Signalling<a href="#signalling" class="hash-link" aria-label="Direct link to Signalling" title="Direct link to Signalling">​</a></h2>
<p>WebRTC can&#x27;t create connections without some sort of server in the middle. We call this the <strong>signal channel</strong> or <strong>signaling service</strong></p>
<p>The information we need to exchange is the <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span> and <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span> which just contains the <a href="/renote/docs/webrtc/protocols#sdp---session-description-protocol"><strong>SDP</strong></a></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span>: A special description is created
by caller. This description includes all the information about the caller&#x27;s
proposed configuration for the call.<!-- --> </p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span>: A description of their end of the
call.</p></div></div>
<p><strong>For example:</strong></p>
<ol>
<li>
<p><em>Peer A</em> who will be the initiator of the connection, will create an <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span>.</p>
</li>
<li>
<p>They will then send this offer to <em>Peer B</em> using the chosen <strong>signal channel</strong>.</p>
</li>
<li>
<p><em>Peer B</em> will receive the <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span> from the <strong>signal channel</strong> and create an <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span>.</p>
</li>
<li>
<p>They will then send this back to <em>Peer A</em> along the <strong>signal channel</strong>.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="session-descriptions">Session descriptions<a href="#session-descriptions" class="hash-link" aria-label="Direct link to Session descriptions" title="Direct link to Session descriptions">​</a></h3>
<p>The configuration of an endpoint on a WebRTC connection is called a <strong>session description</strong>.</p>
<p>The description includes information about the kind of media being sent, its format, the transfer protocol being used, the endpoint&#x27;s IP address and port, and other information needed to describe a media transfer endpoint. This information is exchanged and stored using <a href="/renote/docs/webrtc/protocols#sdp---session-description-protocol"><strong>SDP</strong></a></p>
<p>When a user starts a WebRTC call to another user, the caller create an <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span>. The recipient then responds with an <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span>. In this way, both devices share with one another the information needed in order to exchange media data.</p>
<p>This exchange is handled using <a href="/renote/docs/webrtc/protocols#ice---interactive-connectivity-establishment"><strong>ICE</strong></a>, a protocol which lets two devices use an intermediary to exchange offers and answers even if the two devices are separated by <a href="/renote/docs/webrtc/protocols#nat---network-address-translation"><strong>NAT</strong></a>.</p>
<p>Each peer, then, keeps two descriptions on hand: <strong>the local description</strong>, describing itself, and <strong>the remote description</strong>, describing the other end of the call.</p>
<p>These are the basic steps which must occur to exchange the <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span> and <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span>, leaving out the <a href="/renote/docs/webrtc/protocols#ice---interactive-connectivity-establishment"><strong>ICE</strong></a> layer:</p>
<ol>
<li>
<p>The caller captures local Media via <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer"><code>MediaDevices.getUserMedia</code></a></p>
</li>
<li>
<p>The caller creates <code>RTCPeerConnection</code> and calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addTrack" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.addTrack()</code></a> (Since <code>addStream</code>is deprecating)</p>
</li>
<li>
<p>The caller calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createOffer" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.createOffer()</code></a> to create an <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span>.</p>
</li>
<li>
<p>The caller calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.setLocalDescription()</code></a> to set that <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span> as the <em>local description</em>(that is, the description of the local end of the connection).</p>
</li>
<li>
<p>After setLocalDescription(), the caller asks <a href="/renote/docs/webrtc/protocols#stun---session-traversal-utilities-for-nat"><strong>STUN</strong></a> servers to generate the <a href="/renote/docs/webrtc/protocols#ice---interactive-connectivity-establishment"><strong>ICE</strong></a> candidates</p>
</li>
<li>
<p>The caller uses the signaling server to transmit the <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span> to the intended receiver of the call.</p>
</li>
<li>
<p>The recipient receives the <span style="background-color:#f8703090;border-radius:2px;color:#fff;padding:0.2rem">Offer</span> and calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.setRemoteDescription()</code></a> to record it as the <em>remote description</em> (the description of the other end of the connection).</p>
</li>
<li>
<p>The recipient does any setup it needs to do for its end of the call: capture its local media, and attach each media tracks into the peer connection via <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addTrack" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.addTrack()</code></a></p>
</li>
<li>
<p>The recipient then creates an <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span> by calling <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createAnswer" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.createAnswer()</code></a>.</p>
</li>
<li>
<p>The recipient calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.setLocalDescription()</code></a>, passing in the created answer, to set the answer as its local description. The recipient now knows the configuration of both ends of the connection.</p>
</li>
<li>
<p>The recipient uses the signaling server to send the <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span> to the caller.</p>
</li>
<li>
<p>The caller receives the <span style="background-color:#30c4f890;border-radius:2px;color:#fff;padding:0.2rem">Answer</span>.</p>
</li>
<li>
<p>The caller calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.setRemoteDescription()</code></a> to set the answer as the remote description for its end of the call. It now knows the configuration of both peers. Media begins to flow as configured.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pending-and-current-descriptions">Pending and current descriptions<a href="#pending-and-current-descriptions" class="hash-link" aria-label="Direct link to Pending and current descriptions" title="Direct link to Pending and current descriptions">​</a></h3>
<p>Because during renegotiation, an offer might be rejected because it proposes an incompatible format, it&#x27;s necessary that each endpoint have the ability to propose a new format but not actually switch to it until it&#x27;s accepted by the other peer. For that reason, WebRTC uses <strong>pending and current descriptions</strong>.</p>
<ul>
<li>
<p>The <strong><code>current description</code></strong> (which is returned by the <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/currentLocalDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.currentLocalDescription</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/currentRemoteDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.currentRemoteDescription</code></a> properties) represents the description currently in actual use by the connection. This is the most recent connection that both sides have fully agreed to use.</p>
</li>
<li>
<p>The <strong><code>pending description</code></strong> (returned by <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/pendingLocalDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.pendingLocalDescription</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/pendingRemoteDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.pendingRemoteDescription</code></a>) indicates a description which is currently under consideration following a call to <code>setLocalDescription()</code> or <code>setRemoteDescription()</code>, respectively.</p>
</li>
<li>
<p>When reading the description (returned by <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/localDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.localDescription</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/remoteDescription" target="_blank" rel="noopener noreferrer"><code>RTCPeerConnection.remoteDescription</code></a>), the returned value is the value of <code>pendingLocalDescription</code>/<code>pendingRemoteDescription</code> if there&#x27;s a pending description (that is, the pending description isn&#x27;t <code>null</code>); otherwise, the current description (<code>currentLocalDescription</code>/<code>currentRemoteDescription</code>) is returned.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ice-candidates">ICE candidates<a href="#ice-candidates" class="hash-link" aria-label="Direct link to ICE candidates" title="Direct link to ICE candidates">​</a></h2>
<p>As well as exchanging information about the media, peers must exchange information about the network connection. This is known as an <strong><em>ICE candidate</em></strong> and details the available methods the peer is able to communicate (directly or through a <a href="/renote/docs/webrtc/protocols#turn---session-traversal-utilities-for-nat"><strong>TURN</strong></a> server).</p>
<p>Typically, each peer will propose its best candidates first, making their way down the line toward their worse candidates. Ideally, candidates are <strong>UDP</strong> (since it&#x27;s faster, and media streams are able to recover from interruptions relatively easily), but the ICE standard does allow <strong>TCP</strong> candidates as well.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Generally, ICE candidates using TCP are only going to be used when UDP is not available or is restricted in ways that make it not suitable for media streaming. Not all browsers support ICE over TCP, however.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Trickle ICE WebRTC sample web: <a href="https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/" target="_blank" rel="noopener noreferrer">Trickle ICE WebRTC</a></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="udp-candidate-types">UDP candidate types<a href="#udp-candidate-types" class="hash-link" aria-label="Direct link to UDP candidate types" title="Direct link to UDP candidate types">​</a></h3>
<table><thead><tr><th>Type</th><th>Definition</th></tr></thead><tbody><tr><td><code>host</code></td><td>A host candidate is one for which its <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCIceCandidate/address" target="_blank" rel="noopener noreferrer" title="ip"><code>ip</code></a> address is the actual, direct IP address of the remote peer.</td></tr><tr><td><code>prflx</code></td><td>A peer reflexive candidate is one whose IP address comes from a symmetric NAT between the two peers, usually as an additional candidate during trickle ICE (that is, additional candidate exchanges that occur after primary signaling but before the connection verification phase is finished).</td></tr><tr><td><code>srflx</code></td><td>A server reflexive candidate is generated by a STUN/TURN server; the connection&#x27;s initiator requests a candidate from the STUN server, which forwards the request through the remote peer&#x27;s NAT, which creates and returns a candidate whose IP address is local to the remote peer.<br> The STUN server then replies to the initiator&#x27;s request with a candidate whose IP address is unrelated to the remote peer.</td></tr><tr><td><code>relay</code></td><td>A relay candidate is generated just like a server reflexive candidate (<code>&quot;srflx&quot;</code>), but using TURN instead of STUN.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tcp-candidate-types">TCP candidate types<a href="#tcp-candidate-types" class="hash-link" aria-label="Direct link to TCP candidate types" title="Direct link to TCP candidate types">​</a></h3>
<table><thead><tr><th>Type</th><th>Definition</th></tr></thead><tbody><tr><td><code>active</code></td><td>The transport will try to open an outbound connection but won&#x27;t receive incoming connection requests. This is the most common type, and the only one that most user agents will gather.</td></tr><tr><td><code>passive</code></td><td>The transport will receive incoming connection attempts but won&#x27;t attempt a connection itself.</td></tr><tr><td><code>so</code></td><td>The transport will try to simultaneously open a connection with its peer.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-diagram">Complete diagram<a href="#complete-diagram" class="hash-link" aria-label="Direct link to Complete diagram" title="Direct link to Complete diagram">​</a></h2>
<p><img loading="lazy" alt="Exchange Complete Diagram" src="/renote/assets/images/exchangeCompleteDiagram-5c6ff81aab17c689a6fbbf20344d7add.png" width="641" height="559" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xREMAGIx/renote/tree/main/docs/webrtc/connectivity.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/renote/docs/webrtc/protocols"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">WebRTC Protocols</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/renote/docs/webrtc/negotiation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The WebRTC perfect negotiation pattern</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#signalling" class="table-of-contents__link toc-highlight">Signalling</a><ul><li><a href="#session-descriptions" class="table-of-contents__link toc-highlight">Session descriptions</a></li><li><a href="#pending-and-current-descriptions" class="table-of-contents__link toc-highlight">Pending and current descriptions</a></li></ul></li><li><a href="#ice-candidates" class="table-of-contents__link toc-highlight">ICE candidates</a><ul><li><a href="#udp-candidate-types" class="table-of-contents__link toc-highlight">UDP candidate types</a></li><li><a href="#tcp-candidate-types" class="table-of-contents__link toc-highlight">TCP candidate types</a></li></ul></li><li><a href="#complete-diagram" class="table-of-contents__link toc-highlight">Complete diagram</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/renote/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/renote/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ReNote. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>